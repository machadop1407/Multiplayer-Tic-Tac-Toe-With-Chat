{"ast":null,"code":"import { useEffect, useRef } from 'react';\nimport { useChatContext } from '../../../context/ChatContext';\nexport function useMessageListScrollManager(params) {\n  var onScrollBy = params.onScrollBy,\n      scrollContainerMeasures = params.scrollContainerMeasures,\n      scrolledUpThreshold = params.scrolledUpThreshold,\n      scrollToBottom = params.scrollToBottom,\n      showNewMessages = params.showNewMessages;\n  var client = useChatContext('useMessageListScrollManager').client;\n  var measures = useRef({\n    offsetHeight: 0,\n    scrollHeight: 0\n  });\n  var messages = useRef();\n  var scrollTop = useRef(0);\n  useEffect(function () {\n    scrollToBottom();\n  }, []);\n  useEffect(function () {\n    var _a, _b, _c;\n\n    var prevMeasures = measures.current;\n    var prevMessages = messages.current;\n    var newMessages = params.messages;\n    var lastNewMessage = newMessages[newMessages.length - 1] || {};\n    var lastPrevMessage = prevMessages === null || prevMessages === void 0 ? void 0 : prevMessages[prevMessages.length - 1];\n    var newMeasures = scrollContainerMeasures();\n    var wasAtBottom = prevMeasures.scrollHeight - prevMeasures.offsetHeight - scrollTop.current < scrolledUpThreshold;\n\n    if (typeof prevMessages !== 'undefined') {\n      if (prevMessages.length < newMessages.length) {\n        // messages added to the top\n        if ((lastPrevMessage === null || lastPrevMessage === void 0 ? void 0 : lastPrevMessage.id) === lastNewMessage.id) {\n          var listHeightDelta = newMeasures.scrollHeight - prevMeasures.scrollHeight;\n          onScrollBy(listHeightDelta);\n        } // messages added to the bottom\n        else {\n          var lastMessageIsFromCurrentUser = ((_a = lastNewMessage.user) === null || _a === void 0 ? void 0 : _a.id) === client.userID;\n\n          if (lastMessageIsFromCurrentUser || wasAtBottom) {\n            scrollToBottom();\n          } else {\n            showNewMessages();\n          }\n        }\n      } // message list length didn't change, but check if last message had reaction/reply update\n      else {\n        var hasNewReactions = ((_b = lastPrevMessage === null || lastPrevMessage === void 0 ? void 0 : lastPrevMessage.latest_reactions) === null || _b === void 0 ? void 0 : _b.length) !== ((_c = lastNewMessage.latest_reactions) === null || _c === void 0 ? void 0 : _c.length);\n        var hasNewReplies = (lastPrevMessage === null || lastPrevMessage === void 0 ? void 0 : lastPrevMessage.reply_count) !== lastNewMessage.reply_count;\n\n        if ((hasNewReactions || hasNewReplies) && wasAtBottom) {\n          scrollToBottom();\n        }\n      }\n    }\n\n    messages.current = newMessages;\n    measures.current = newMeasures;\n  }, [measures, messages, params.messages]);\n  return function (scrollTopValue) {\n    scrollTop.current = scrollTopValue;\n  };\n}","map":{"version":3,"sources":["/Users/pedrohenriquemachado/Documents/Projects/multi-tic-tac-toe/client/node_modules/stream-chat-react/dist/components/MessageList/hooks/useMessageListScrollManager.js"],"names":["useEffect","useRef","useChatContext","useMessageListScrollManager","params","onScrollBy","scrollContainerMeasures","scrolledUpThreshold","scrollToBottom","showNewMessages","client","measures","offsetHeight","scrollHeight","messages","scrollTop","_a","_b","_c","prevMeasures","current","prevMessages","newMessages","lastNewMessage","length","lastPrevMessage","newMeasures","wasAtBottom","id","listHeightDelta","lastMessageIsFromCurrentUser","user","userID","hasNewReactions","latest_reactions","hasNewReplies","reply_count","scrollTopValue"],"mappings":"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","sourcesContent":["import { useEffect, useRef } from 'react';\nimport { useChatContext } from '../../../context/ChatContext';\nexport function useMessageListScrollManager(params) {\n    var onScrollBy = params.onScrollBy, scrollContainerMeasures = params.scrollContainerMeasures, scrolledUpThreshold = params.scrolledUpThreshold, scrollToBottom = params.scrollToBottom, showNewMessages = params.showNewMessages;\n    var client = useChatContext('useMessageListScrollManager').client;\n    var measures = useRef({\n        offsetHeight: 0,\n        scrollHeight: 0,\n    });\n    var messages = useRef();\n    var scrollTop = useRef(0);\n    useEffect(function () {\n        scrollToBottom();\n    }, []);\n    useEffect(function () {\n        var _a, _b, _c;\n        var prevMeasures = measures.current;\n        var prevMessages = messages.current;\n        var newMessages = params.messages;\n        var lastNewMessage = newMessages[newMessages.length - 1] || {};\n        var lastPrevMessage = prevMessages === null || prevMessages === void 0 ? void 0 : prevMessages[prevMessages.length - 1];\n        var newMeasures = scrollContainerMeasures();\n        var wasAtBottom = prevMeasures.scrollHeight - prevMeasures.offsetHeight - scrollTop.current <\n            scrolledUpThreshold;\n        if (typeof prevMessages !== 'undefined') {\n            if (prevMessages.length < newMessages.length) {\n                // messages added to the top\n                if ((lastPrevMessage === null || lastPrevMessage === void 0 ? void 0 : lastPrevMessage.id) === lastNewMessage.id) {\n                    var listHeightDelta = newMeasures.scrollHeight - prevMeasures.scrollHeight;\n                    onScrollBy(listHeightDelta);\n                }\n                // messages added to the bottom\n                else {\n                    var lastMessageIsFromCurrentUser = ((_a = lastNewMessage.user) === null || _a === void 0 ? void 0 : _a.id) === client.userID;\n                    if (lastMessageIsFromCurrentUser || wasAtBottom) {\n                        scrollToBottom();\n                    }\n                    else {\n                        showNewMessages();\n                    }\n                }\n            }\n            // message list length didn't change, but check if last message had reaction/reply update\n            else {\n                var hasNewReactions = ((_b = lastPrevMessage === null || lastPrevMessage === void 0 ? void 0 : lastPrevMessage.latest_reactions) === null || _b === void 0 ? void 0 : _b.length) !== ((_c = lastNewMessage.latest_reactions) === null || _c === void 0 ? void 0 : _c.length);\n                var hasNewReplies = (lastPrevMessage === null || lastPrevMessage === void 0 ? void 0 : lastPrevMessage.reply_count) !== lastNewMessage.reply_count;\n                if ((hasNewReactions || hasNewReplies) && wasAtBottom) {\n                    scrollToBottom();\n                }\n            }\n        }\n        messages.current = newMessages;\n        measures.current = newMeasures;\n    }, [measures, messages, params.messages]);\n    return function (scrollTopValue) {\n        scrollTop.current = scrollTopValue;\n    };\n}\n"]},"metadata":{},"sourceType":"module"}