{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport React from 'react';\nimport emojiRegex from 'emoji-regex';\nimport * as linkify from 'linkifyjs'; //@ts-expect-error\n\nimport findAndReplace from 'mdast-util-find-and-replace';\nimport RootReactMarkdown from 'react-markdown';\nimport ReactMarkdown from 'react-markdown/with-html';\nimport uniqBy from 'lodash.uniqby';\nexport var isOnlyEmojis = function (text) {\n  if (!text) return false;\n  var noEmojis = text.replace(emojiRegex(), '');\n  var noSpace = noEmojis.replace(/[\\s\\n]/gm, '');\n  return !noSpace;\n};\nvar allowedMarkups = ['html', // @ts-expect-error\n'root', 'text', 'break', 'paragraph', 'emphasis', 'strong', 'link', 'list', 'listItem', 'code', 'inlineCode', 'blockquote', 'delete'];\nexport var matchMarkdownLinks = function (message) {\n  var regexMdLinks = /\\[([^[]+)\\](\\(.*\\))/gm;\n  var matches = message.match(regexMdLinks);\n  var singleMatch = /\\[([^[]+)\\]\\((.*)\\)/;\n  var links = matches ? matches.map(function (match) {\n    var i = singleMatch.exec(match);\n    return i && [i[1], i[2]];\n  }) : [];\n  return links.flat();\n};\nexport var messageCodeBlocks = function (message) {\n  var codeRegex = /```[a-z]*\\n[\\s\\S]*?\\n```|`[a-z]*[\\s\\S]*?`/gm;\n  var matches = message.match(codeRegex);\n  return matches || [];\n};\nvar detectHttp = /(http(s?):\\/\\/)?(www\\.)?/;\n\nfunction formatUrlForDisplay(url) {\n  try {\n    return decodeURIComponent(url).replace(detectHttp, '');\n  } catch (e) {\n    return url;\n  }\n}\n\nfunction encodeDecode(url) {\n  try {\n    return encodeURI(decodeURIComponent(url));\n  } catch (error) {\n    return url;\n  }\n}\n\nexport var markDownRenderers = {\n  // eslint-disable-next-line react/display-name\n  link: function (props) {\n    var children = props.children,\n        href = props.href;\n    var isEmail = href === null || href === void 0 ? void 0 : href.startsWith('mailto:');\n    var isUrl = href === null || href === void 0 ? void 0 : href.startsWith('http');\n\n    if (!href || !isEmail && !isUrl) {\n      return children;\n    }\n\n    return React.createElement(\"a\", {\n      className: \"\" + (isUrl ? 'str-chat__message-url-link' : ''),\n      href: href,\n      rel: 'nofollow noreferrer noopener',\n      target: '_blank'\n    }, children);\n  },\n  span: 'span'\n};\nexport var emojiMarkdownPlugin = function () {\n  function replace(match) {\n    return {\n      children: [{\n        type: 'text',\n        value: match\n      }],\n      className: 'inline-text-emoji',\n      type: 'span'\n    };\n  }\n\n  var transform = function (markdownAST) {\n    findAndReplace(markdownAST, emojiRegex(), replace);\n    return markdownAST;\n  };\n\n  return transform;\n};\nexport var mentionsMarkdownPlugin = function (mentioned_users) {\n  return function () {\n    var mentioned_usernames = mentioned_users.map(function (user) {\n      return user.name || user.id;\n    }).filter(Boolean).map(escapeRegExp);\n\n    function replace(match) {\n      var usernameOrId = match.replace('@', '');\n      var user = mentioned_users.find(function (_a) {\n        var id = _a.id,\n            name = _a.name;\n        return name === usernameOrId || id === usernameOrId;\n      });\n      return {\n        children: [{\n          type: 'text',\n          value: match\n        }],\n        mentioned_user: user,\n        type: 'mention'\n      };\n    }\n\n    var transform = function (markdownAST) {\n      if (!mentioned_usernames.length) {\n        return markdownAST;\n      }\n\n      var mentionedUsersRegex = new RegExp(mentioned_usernames.map(function (username) {\n        return \"@\" + username;\n      }).join('|'), 'g');\n      findAndReplace(markdownAST, mentionedUsersRegex, replace);\n      return markdownAST;\n    };\n\n    return transform;\n  };\n};\n\nvar Mention = function (props) {\n  return React.createElement(\"span\", {\n    className: 'str-chat__message-mention'\n  }, props.children);\n};\n\nexport var renderText = function (text, mentioned_users, options) {\n  if (options === void 0) {\n    options = {};\n  } // take the @ mentions and turn them into markdown?\n  // translate links\n\n\n  if (!text) return null;\n  var newText = text;\n  var markdownLinks = matchMarkdownLinks(newText);\n  var codeBlocks = messageCodeBlocks(newText); // extract all valid links/emails within text and replace it with proper markup\n\n  uniqBy(linkify.find(newText), 'value').forEach(function (_a) {\n    var href = _a.href,\n        type = _a.type,\n        value = _a.value;\n    var linkIsInBlock = codeBlocks.some(function (block) {\n      return block === null || block === void 0 ? void 0 : block.includes(value);\n    }); // check if message is already  markdown\n\n    var noParsingNeeded = markdownLinks && markdownLinks.filter(function (text) {\n      var strippedHref = href === null || href === void 0 ? void 0 : href.replace(detectHttp, '');\n      var strippedText = text === null || text === void 0 ? void 0 : text.replace(detectHttp, '');\n      if (!strippedHref || !strippedText) return false;\n      return strippedHref.includes(strippedText) || strippedText.includes(strippedHref);\n    });\n    if (noParsingNeeded.length > 0 || linkIsInBlock) return;\n\n    try {\n      var displayLink = type === 'email' ? value : formatUrlForDisplay(href);\n      newText = newText.replace(new RegExp(escapeRegExp(value), 'g'), \"[\" + displayLink + \"](\" + encodeDecode(href) + \")\");\n    } catch (e) {\n      void e;\n    }\n  });\n  var plugins = [emojiMarkdownPlugin];\n\n  if (mentioned_users === null || mentioned_users === void 0 ? void 0 : mentioned_users.length) {\n    plugins.push(mentionsMarkdownPlugin(mentioned_users));\n  }\n\n  var renderers = __assign(__assign({\n    mention: Mention\n  }, markDownRenderers), options.customMarkDownRenderers);\n\n  return React.createElement(ReactMarkdown, {\n    allowedTypes: allowedMarkups,\n    escapeHtml: true,\n    plugins: plugins,\n    renderers: renderers,\n    source: newText,\n    transformLinkUri: function (uri) {\n      return uri.startsWith('app://') ? uri : RootReactMarkdown.uriTransformer(uri);\n    },\n    unwrapDisallowed: true\n  });\n};\nexport function escapeRegExp(text) {\n  return text.replace(/[-[\\]{}()*+?.,\\\\^$|#]/g, '\\\\$&');\n}\n\nfunction S4() {\n  return ((1 + Math.random()) * 0x10000 | 0).toString(16).substring(1);\n} // https://stackoverflow.com/a/6860916/2570866\n\n\nexport function generateRandomId() {\n  // prettier-ignore\n  return S4() + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + S4() + S4();\n} // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/charAt#getting_whole_characters\n\nexport var getWholeChar = function (str, i) {\n  var code = str.charCodeAt(i);\n  if (Number.isNaN(code)) return '';\n  if (code < 0xd800 || code > 0xdfff) return str.charAt(i);\n\n  if (0xd800 <= code && code <= 0xdbff) {\n    if (str.length <= i + 1) {\n      throw 'High surrogate without following low surrogate';\n    }\n\n    var next = str.charCodeAt(i + 1);\n\n    if (0xdc00 > next || next > 0xdfff) {\n      throw 'High surrogate without following low surrogate';\n    }\n\n    return str.charAt(i) + str.charAt(i + 1);\n  }\n\n  if (i === 0) {\n    throw 'Low surrogate without preceding high surrogate';\n  }\n\n  var prev = str.charCodeAt(i - 1);\n\n  if (0xd800 > prev || prev > 0xdbff) {\n    throw 'Low surrogate without preceding high surrogate';\n  }\n\n  return '';\n};","map":{"version":3,"sources":["/Users/pedrohenriquemachado/Documents/Projects/multi-tic-tac-toe/client/node_modules/stream-chat-react/dist/utils.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","React","emojiRegex","linkify","findAndReplace","RootReactMarkdown","ReactMarkdown","uniqBy","isOnlyEmojis","text","noEmojis","replace","noSpace","allowedMarkups","matchMarkdownLinks","message","regexMdLinks","matches","match","singleMatch","links","map","exec","flat","messageCodeBlocks","codeRegex","detectHttp","formatUrlForDisplay","url","decodeURIComponent","e","encodeDecode","encodeURI","error","markDownRenderers","link","props","children","href","isEmail","startsWith","isUrl","createElement","className","rel","target","span","emojiMarkdownPlugin","type","value","transform","markdownAST","mentionsMarkdownPlugin","mentioned_users","mentioned_usernames","user","name","id","filter","Boolean","escapeRegExp","usernameOrId","find","_a","mentioned_user","mentionedUsersRegex","RegExp","username","join","Mention","renderText","options","newText","markdownLinks","codeBlocks","forEach","linkIsInBlock","some","block","includes","noParsingNeeded","strippedHref","strippedText","displayLink","plugins","push","renderers","mention","customMarkDownRenderers","allowedTypes","escapeHtml","source","transformLinkUri","uri","uriTransformer","unwrapDisallowed","S4","Math","random","toString","substring","generateRandomId","getWholeChar","str","code","charCodeAt","Number","isNaN","charAt","next","prev"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport React from 'react';\nimport emojiRegex from 'emoji-regex';\nimport * as linkify from 'linkifyjs';\n//@ts-expect-error\nimport findAndReplace from 'mdast-util-find-and-replace';\nimport RootReactMarkdown from 'react-markdown';\nimport ReactMarkdown from 'react-markdown/with-html';\nimport uniqBy from 'lodash.uniqby';\nexport var isOnlyEmojis = function (text) {\n    if (!text)\n        return false;\n    var noEmojis = text.replace(emojiRegex(), '');\n    var noSpace = noEmojis.replace(/[\\s\\n]/gm, '');\n    return !noSpace;\n};\nvar allowedMarkups = [\n    'html',\n    // @ts-expect-error\n    'root',\n    'text',\n    'break',\n    'paragraph',\n    'emphasis',\n    'strong',\n    'link',\n    'list',\n    'listItem',\n    'code',\n    'inlineCode',\n    'blockquote',\n    'delete',\n];\nexport var matchMarkdownLinks = function (message) {\n    var regexMdLinks = /\\[([^[]+)\\](\\(.*\\))/gm;\n    var matches = message.match(regexMdLinks);\n    var singleMatch = /\\[([^[]+)\\]\\((.*)\\)/;\n    var links = matches\n        ? matches.map(function (match) {\n            var i = singleMatch.exec(match);\n            return i && [i[1], i[2]];\n        })\n        : [];\n    return links.flat();\n};\nexport var messageCodeBlocks = function (message) {\n    var codeRegex = /```[a-z]*\\n[\\s\\S]*?\\n```|`[a-z]*[\\s\\S]*?`/gm;\n    var matches = message.match(codeRegex);\n    return matches || [];\n};\nvar detectHttp = /(http(s?):\\/\\/)?(www\\.)?/;\nfunction formatUrlForDisplay(url) {\n    try {\n        return decodeURIComponent(url).replace(detectHttp, '');\n    }\n    catch (e) {\n        return url;\n    }\n}\nfunction encodeDecode(url) {\n    try {\n        return encodeURI(decodeURIComponent(url));\n    }\n    catch (error) {\n        return url;\n    }\n}\nexport var markDownRenderers = {\n    // eslint-disable-next-line react/display-name\n    link: function (props) {\n        var children = props.children, href = props.href;\n        var isEmail = href === null || href === void 0 ? void 0 : href.startsWith('mailto:');\n        var isUrl = href === null || href === void 0 ? void 0 : href.startsWith('http');\n        if (!href || (!isEmail && !isUrl)) {\n            return children;\n        }\n        return (React.createElement(\"a\", { className: \"\" + (isUrl ? 'str-chat__message-url-link' : ''), href: href, rel: 'nofollow noreferrer noopener', target: '_blank' }, children));\n    },\n    span: 'span',\n};\nexport var emojiMarkdownPlugin = function () {\n    function replace(match) {\n        return {\n            children: [{ type: 'text', value: match }],\n            className: 'inline-text-emoji',\n            type: 'span',\n        };\n    }\n    var transform = function (markdownAST) {\n        findAndReplace(markdownAST, emojiRegex(), replace);\n        return markdownAST;\n    };\n    return transform;\n};\nexport var mentionsMarkdownPlugin = function (mentioned_users) { return function () {\n    var mentioned_usernames = mentioned_users\n        .map(function (user) { return user.name || user.id; })\n        .filter(Boolean)\n        .map(escapeRegExp);\n    function replace(match) {\n        var usernameOrId = match.replace('@', '');\n        var user = mentioned_users.find(function (_a) {\n            var id = _a.id, name = _a.name;\n            return name === usernameOrId || id === usernameOrId;\n        });\n        return {\n            children: [{ type: 'text', value: match }],\n            mentioned_user: user,\n            type: 'mention',\n        };\n    }\n    var transform = function (markdownAST) {\n        if (!mentioned_usernames.length) {\n            return markdownAST;\n        }\n        var mentionedUsersRegex = new RegExp(mentioned_usernames.map(function (username) { return \"@\" + username; }).join('|'), 'g');\n        findAndReplace(markdownAST, mentionedUsersRegex, replace);\n        return markdownAST;\n    };\n    return transform;\n}; };\nvar Mention = function (props) { return React.createElement(\"span\", { className: 'str-chat__message-mention' }, props.children); };\nexport var renderText = function (text, mentioned_users, options) {\n    if (options === void 0) { options = {}; }\n    // take the @ mentions and turn them into markdown?\n    // translate links\n    if (!text)\n        return null;\n    var newText = text;\n    var markdownLinks = matchMarkdownLinks(newText);\n    var codeBlocks = messageCodeBlocks(newText);\n    // extract all valid links/emails within text and replace it with proper markup\n    uniqBy(linkify.find(newText), 'value').forEach(function (_a) {\n        var href = _a.href, type = _a.type, value = _a.value;\n        var linkIsInBlock = codeBlocks.some(function (block) { return block === null || block === void 0 ? void 0 : block.includes(value); });\n        // check if message is already  markdown\n        var noParsingNeeded = markdownLinks &&\n            markdownLinks.filter(function (text) {\n                var strippedHref = href === null || href === void 0 ? void 0 : href.replace(detectHttp, '');\n                var strippedText = text === null || text === void 0 ? void 0 : text.replace(detectHttp, '');\n                if (!strippedHref || !strippedText)\n                    return false;\n                return strippedHref.includes(strippedText) || strippedText.includes(strippedHref);\n            });\n        if (noParsingNeeded.length > 0 || linkIsInBlock)\n            return;\n        try {\n            var displayLink = type === 'email' ? value : formatUrlForDisplay(href);\n            newText = newText.replace(new RegExp(escapeRegExp(value), 'g'), \"[\" + displayLink + \"](\" + encodeDecode(href) + \")\");\n        }\n        catch (e) {\n            void e;\n        }\n    });\n    var plugins = [emojiMarkdownPlugin];\n    if (mentioned_users === null || mentioned_users === void 0 ? void 0 : mentioned_users.length) {\n        plugins.push(mentionsMarkdownPlugin(mentioned_users));\n    }\n    var renderers = __assign(__assign({ mention: Mention }, markDownRenderers), options.customMarkDownRenderers);\n    return (React.createElement(ReactMarkdown, { allowedTypes: allowedMarkups, escapeHtml: true, plugins: plugins, renderers: renderers, source: newText, transformLinkUri: function (uri) {\n            return uri.startsWith('app://') ? uri : RootReactMarkdown.uriTransformer(uri);\n        }, unwrapDisallowed: true }));\n};\nexport function escapeRegExp(text) {\n    return text.replace(/[-[\\]{}()*+?.,\\\\^$|#]/g, '\\\\$&');\n}\nfunction S4() {\n    return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n}\n// https://stackoverflow.com/a/6860916/2570866\nexport function generateRandomId() {\n    // prettier-ignore\n    return (S4() + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + S4() + S4());\n}\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/charAt#getting_whole_characters\nexport var getWholeChar = function (str, i) {\n    var code = str.charCodeAt(i);\n    if (Number.isNaN(code))\n        return '';\n    if (code < 0xd800 || code > 0xdfff)\n        return str.charAt(i);\n    if (0xd800 <= code && code <= 0xdbff) {\n        if (str.length <= i + 1) {\n            throw 'High surrogate without following low surrogate';\n        }\n        var next = str.charCodeAt(i + 1);\n        if (0xdc00 > next || next > 0xdfff) {\n            throw 'High surrogate without following low surrogate';\n        }\n        return str.charAt(i) + str.charAt(i + 1);\n    }\n    if (i === 0) {\n        throw 'Low surrogate without preceding high surrogate';\n    }\n    var prev = str.charCodeAt(i - 1);\n    if (0xd800 > prev || prev > 0xdbff) {\n        throw 'Low surrogate without preceding high surrogate';\n    }\n    return '';\n};\n"]},"metadata":{},"sourceType":"module"}